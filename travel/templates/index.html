{% extends 'base.html' %}
{% block content %}

<!-- HERO -->
<section class="exr-shell mb-4 text-center">
  <div class="hero-inner container">
    <h1 class="h3 fw-bold mb-2">Welcome to ExpertRelay!</h1>
    <p class="lead mb-4">Find and create events, and connect with industry professionals</p>

    <form class="hero-search" action="{{ url_for('main.search') }}" method="get">
      <div class="input-group input-group-lg">
        <input type="text" name="q" class="form-control" placeholder="Search for events"
          value="{{ request.args.get('q', '') }}">
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>
  </div>
</section>

<main class="exr-shell">
  <div class="container mt-4">
    <div class="row">
      <!-- SIDEBAR: Categories -->
      <aside class="col-12 col-md-3 mb-4">
        <div class="list-group sticky-top" style="top: 1rem;">
          <a href="{{ url_for('main.index') }}"
            class="list-group-item list-group-item-action {% if not active_category %}active{% endif %}">
            All
          </a>
          {% for c in categories %}
          <a href="{{ url_for('main.index', cat=c.id) }}"
            class="list-group-item list-group-item-action {% if active_category and c.id==active_category.id %}active{% endif %}">
            {{ c.name }}
          </a>
          {% endfor %}
        </div>
      </aside>

      <!-- EVENTS GRID -->
      <section class="col-12 col-md-9">
        {% if active_category %}
        <h2 class="h4 mb-3">{{ active_category.name }} events</h2>
        {% else %}
        <h2 class="h4 mb-3">Upcoming events</h2>
        {% endif %}

        <div class="row g-4">
          {% for e in events %}
          <div class="col-12 col-sm-6 col-lg-4">
            <!-- Event Title -->
            <a class="event-card card h-100 shadow-sm text-decoration-none"
              href="{{ url_for('main.event_detail', event_id=e.id) }}">
              {% if e.image %}
              <!-- Event heero image -->
              <img src="{{ url_for('static', filename='uploads/' + e.image) }}" alt="{{ e.title }}"
                class="card-img-top img-fluid"
                style="object-fit: cover; height: 200px; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem;">
              {% endif %}
              <!-- Event start date and venue/location -->
              <div class="card-body">
                <h3 class="h6 card-title mb-2">{{ e.title }}</h3>
                <p class="text-muted small mb-2">
                  {{ e.start_at.strftime('%d/%m/%Y, %I:%M %p') }}{% if e.venue %} • {{ e.venue }}{% endif %}
                </p>
                <!-- Event description -->
                <p class="card-text text-muted small">
                  {{ e.description[:120] }}{% if e.description|length > 120 %}…{% endif %}
                </p>
              </div>
              <div class="card-footer bg-white border-0">
                <span class="badge bg-secondary">{{ e.status }}</span>
                <span class="badge bg-secondary">{{ e.category.name }}</span>
                {% if e.tickets_av and e.tickets_av>0 %}
                <span class="badge bg-success">{{ e.tickets_av }} tickets</span>
                {% endif %}
                <span class="badge bg-secondary">{{ '%0.2f'|format(e.price|float) }} A$</span>
              </div>
            </a>
          </div>
          {% else %}
          <p class="text-muted">No events yet.</p>
          {% endfor %}
        </div>
      </section>
    </div>
  </div>
</main>
{% endblock %}